import{a as me}from"./chunk-GPPR4BAL.js";import{a as pe}from"./chunk-LNAHWHDB.js";import"./chunk-R3DSXEXQ.js";import{b as I,c as k,f as D,g as A,h as oe,i as ae,j as se,k as re,l as le,m as S}from"./chunk-UPQQ6FNK.js";import{p as E}from"./chunk-UH4UVRDG.js";import{$b as u,Ca as X,Eb as O,Fb as P,Hb as K,Ib as L,Jb as W,Kb as _,Lb as o,Mb as a,Nb as x,Rb as w,Za as Y,Zb as c,ab as m,fb as $,jc as ee,lb as y,lc as te,oa as g,oc as r,pa as p,pc as ne,qc as ie,sc as h,tb as v,tc as C,uc as M}from"./chunk-WZJH74Y7.js";import{a as f,b,c as Q,e as ge,h as z}from"./chunk-AQY5CCQG.js";var ue=(d,e)=>e.item_id;function _e(d,e){if(d&1&&(o(0,"option",4),r(1),a()),d&2){let t=e.$implicit;_("value",t.item_id),m(),ne(t.description)}}var V=class V{constructor(){this.messages=[];this.item_id_selected=0;this.modelChange=new v;this.tipoCambiado=new v;this.item_idCambiado=new v;this.trackByItemId=(e,t)=>t.item_id??-1}onItemIdChange(e){let t=Number(e)||0;this.item_idCambiado.emit(t)}onTipoChange(e){this.tipoCambiado.emit(e);let t=b(f({},this.model),{type:e});e==="Texto"?((typeof t.content!="object"||t.content===null||!("title"in t.content)||!("text"in t.content))&&(t.content={title:"",text:""}),t.width=void 0):e==="Imagen"&&(typeof t.content!="object"||t.content===null||!("image"in t.content))&&(t.content={image:""}),this.modelChange.emit(t)}onDuracionChange(e){let t=Math.max(0,Number(e)||0);t!==this.model.duration?this.modelChange.emit(b(f({},this.model),{duration:t})):this.modelChange.emit(f({},this.model))}onLinkChange(e){let t=(e??"").trim();t!==this.model.link?this.modelChange.emit(b(f({},this.model),{link:t})):this.modelChange.emit(f({},this.model))}esLinkValido(e){if(!e)return!1;try{let t=new URL(e);return t.protocol==="http:"||t.protocol==="https:"}catch{return!1}}abrirLink(){this.esLinkValido(this.model?.link)&&window.open(this.model.link,"_blank","noopener,noreferrer")}};V.\u0275fac=function(t){return new(t||V)},V.\u0275cmp=y({type:V,selectors:[["app-base-message"]],inputs:{model:"model",messages:"messages",item_id_selected:"item_id_selected"},outputs:{modelChange:"modelChange",tipoCambiado:"tipoCambiado",item_idCambiado:"item_idCambiado"},decls:41,vars:6,consts:[[1,"mb-3"],["for","mensajeSelect",1,"form-label"],["id","mensajeSelect",1,"form-select",3,"ngModelChange","ngModel"],["value","0"],[3,"value"],[1,"form-text","text-muted"],["for","descripcionInput",1,"form-label"],["type","text","id","descripcionInput","placeholder","Ejemplo: Mensaje de bienvenida",1,"form-control",3,"ngModelChange","ngModel"],["for","tipoSelect",1,"form-label"],["id","tipoSelect",1,"form-select",3,"ngModelChange","ngModel"],["value","image"],["value","text"],["for","duracionInput",1,"form-label"],["type","number","id","duracionInput","step","1","min","10",1,"form-control",3,"ngModelChange","ngModel"],["for","linkInput",1,"form-label"],[1,"input-group"],["type","url","id","linkInput","placeholder","https://ejemplo.com",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-outline-primary",3,"click","disabled"],[1,"fas","fa-external-link-alt"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"label",1),r(2,"Mensajes"),a(),o(3,"select",2),M("ngModelChange",function(i){return C(n.item_id_selected,i)||(n.item_id_selected=i),i}),c("ngModelChange",function(i){return n.onItemIdChange(i)}),o(4,"option",3),r(5,"Crear nuevo mensaje"),a(),L(6,_e,2,2,"option",4,ue),a(),o(8,"small",5),r(9,"Seleccione un mensaje existente o cree uno nuevo."),a()(),o(10,"div",0)(11,"label",6),r(12,"Descripci\xF3n Corta"),a(),o(13,"input",7),M("ngModelChange",function(i){return C(n.model.description,i)||(n.model.description=i),i}),a(),o(14,"small",5),r(15,"Sirve para identificar el mensaje."),a()(),o(16,"div",0)(17,"label",8),r(18,"Tipo"),a(),o(19,"select",9),M("ngModelChange",function(i){return C(n.model.type,i)||(n.model.type=i),i}),c("ngModelChange",function(i){return n.onTipoChange(i)}),o(20,"option",10),r(21,"Imagen"),a(),o(22,"option",11),r(23,"Texto"),a()(),o(24,"small",5),r(25,"Permite escoger el tipo de mensaje."),a()(),o(26,"div",0)(27,"label",12),r(28,"Duraci\xF3n"),a(),o(29,"input",13),M("ngModelChange",function(i){return C(n.model.duration,i)||(n.model.duration=i),i}),c("ngModelChange",function(i){return n.onDuracionChange(i)}),a(),o(30,"small",5),r(31,"Establece el tiempo en segundos que el mensaje estar\xE1 visible en pantalla."),a()(),o(32,"div",0)(33,"label",14),r(34,"Link"),a(),o(35,"div",15)(36,"input",16),M("ngModelChange",function(i){return C(n.model.link,i)||(n.model.link=i),i}),c("ngModelChange",function(i){return n.onLinkChange(i)}),a(),o(37,"button",17),c("click",function(){return n.abrirLink()}),x(38,"i",18),a()(),o(39,"small",5),r(40," Establece la URL que se abrir\xE1 al dar clic en el mensaje. "),a()()),t&2&&(m(3),h("ngModel",n.item_id_selected),m(3),W(n.messages),m(7),h("ngModel",n.model.description),m(6),h("ngModel",n.model.type),m(10),h("ngModel",n.model.duration),m(7),h("ngModel",n.model.link),m(),_("disabled",!n.esLinkValido(n.model.link)))},dependencies:[E,S,ae,se,I,A,oe,k,re,D],encapsulation:2,changeDetection:0});var q=V;function fe(d,e){d&1&&(o(0,"p"),r(1,"Arrastra una imagen aqu\xED o haz clic para seleccionarla"),a())}function he(d,e){if(d&1&&x(0,"img",6),d&2){let t=u();_("src",t.imagenCargada,Y)}}var j=class j{constructor(){this.modelChange=new v;this.imagenCargada=null;this.dragging=!1}ngOnChanges(e){if("model"in e&&this.model){let t=this.leerBase64Actual();this.imagenCargada=t?this.toDataUrl(t):null}}emitirAncho(e){let t;if(typeof e=="number"||typeof e=="string")t=Number(e)||0;else{let n=e.target;t=Number(n?.value)||0}this.modelChange.emit(b(f({},this.model),{width:t}))}onDragOver(e){e.preventDefault(),this.dragging=!0}onDragLeave(e){e.preventDefault(),this.dragging=!1}onDrop(e){e.preventDefault(),this.dragging=!1;let t=e.dataTransfer?.files?.[0];t&&this.cargarArchivo(t)}onFileSelected(e){let n=e.target.files?.[0];n&&this.cargarArchivo(n)}cargarArchivo(e){let t=new FileReader;t.onload=()=>{let n=t.result,s=this.extractBase64(n),i=b(f({},typeof this.model.content=="object"?this.model.content:{}),{image:s}),l=b(f({},this.model),{content:i});this.imagenCargada=this.toDataUrl(s),this.modelChange.emit(l)},t.readAsDataURL(e)}extractBase64(e){let t=e.indexOf(",");return t>=0?e.slice(t+1):e}toDataUrl(e,t="image/png"){return`data:${t};base64,${e}`}leerBase64Actual(){if(this.model?.content&&typeof this.model.content=="object"&&"image"in this.model.content){let e=this.model.content.image;if(typeof e=="string"&&e.length>0)return e}return null}};j.\u0275fac=function(t){return new(t||j)},j.\u0275cmp=y({type:j,selectors:[["app-image-message"]],inputs:{model:"model"},outputs:{modelChange:"modelChange"},features:[X],decls:13,vars:2,consts:[["fileInput",""],[1,"mb-3"],["for","anchoInput",1,"form-label"],["type","number","id","anchoInput","step","1",1,"form-control",3,"ngModelChange","input","ngModel"],[1,"form-text","text-muted"],[1,"drag-drop-zone",3,"click","dragover","dragleave","drop"],["alt","Vista previa",1,"img-preview",3,"src"],["type","file","accept","image/*","hidden","",3,"change"]],template:function(t,n){if(t&1){let s=w();o(0,"div",1)(1,"label",2),r(2,"Ancho"),a(),o(3,"input",3),M("ngModelChange",function(l){return g(s),C(n.model.width,l)||(n.model.width=l),p(l)}),c("input",function(l){return g(s),p(n.emitirAncho(l))}),a(),o(4,"small",4),r(5,"Establece el ancho en p\xEDxeles que ocupar\xE1 el mensaje."),a()(),o(6,"div",5),c("click",function(){g(s);let l=ee(10);return p(l.click())})("dragover",function(l){return g(s),p(n.onDragOver(l))})("dragleave",function(l){return g(s),p(n.onDragLeave(l))})("drop",function(l){return g(s),p(n.onDrop(l))}),O(7,fe,2,0,"p")(8,he,1,1,"img",6),o(9,"input",7,0),c("change",function(l){return g(s),p(n.onFileSelected(l))}),a()(),o(11,"small",4),r(12,"Establece la imagen que se enviar\xE1 en el mensaje."),a()}t&2&&(m(3),h("ngModel",n.model.width),m(4),P(n.imagenCargada?8:7))},dependencies:[E,S,I,A,k,D],styles:[".drag-drop-zone[_ngcontent-%COMP%]{border:2px dashed #ccc;border-radius:10px;padding:30px;text-align:center;color:#999;transition:background-color .3s;cursor:pointer}.drag-drop-zone[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}.img-preview[_ngcontent-%COMP%]{max-width:100%;max-height:200px;border-radius:10px;margin-top:10px}"],changeDetection:0});var R=j;var B=class B{constructor(){this.modelChange=new v}emitirCambio(){this.modelChange.emit(this.model)}get textoModel(){return typeof this.model.content=="object"&&this.model.content!==null?this.model.content:{title:"",text:""}}};B.\u0275fac=function(t){return new(t||B)},B.\u0275cmp=y({type:B,selectors:[["app-text-message"]],inputs:{model:"model"},outputs:{modelChange:"modelChange"},decls:13,vars:2,consts:[[1,"mb-3"],["for","tituloInput",1,"form-label"],["type","text","id","tituloInput","maxlength","100","placeholder","Ingrese el t\xEDtulo del mensaje",1,"form-control",3,"ngModelChange","input","ngModel"],[1,"form-text","text-muted"],["for","contenidoTextarea",1,"form-label"],["id","contenidoTextarea","rows","3","maxlength","150","placeholder","Ingrese el contenido del mensaje",1,"form-control",3,"ngModelChange","input","ngModel"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"label",1),r(2,"T\xEDtulo"),a(),o(3,"input",2),M("ngModelChange",function(i){return C(n.textoModel.title,i)||(n.textoModel.title=i),i}),c("input",function(){return n.emitirCambio()}),a(),o(4,"small",3),r(5,"Establece el t\xEDtulo del mensaje de texto a enviar."),a()(),o(6,"div",0)(7,"label",4),r(8,"Contenido"),a(),o(9,"textarea",5),M("ngModelChange",function(i){return C(n.textoModel.text,i)||(n.textoModel.text=i),i}),c("input",function(){return n.emitirCambio()}),r(10,"  "),a(),o(11,"small",3),r(12,"Establece el contenido del mensaje de texto a enviar."),a()()),t&2&&(m(3),h("ngModel",n.textoModel.title),m(6),h("ngModel",n.textoModel.text))},dependencies:[E,S,I,k,le,D],encapsulation:2});var G=B;function Ce(d,e){if(d&1){let t=w();o(0,"td",7),c("mouseenter",function(){let s=g(t).$implicit,i=u(2);return p(i.hovered=s)})("mouseleave",function(){g(t);let s=u(2);return p(s.hovered=null)})("click",function(){let s=g(t).$implicit,i=u(2);return p(i.seleccionar(s))}),r(1),a()}if(d&2){let t=e.$implicit,n=u(2);te("hovered",n.hovered===t)("selected",n.seleccion===t),m(),ie(" ",t," ")}}function Me(d,e){if(d&1&&(o(0,"tr"),L(1,Ce,2,5,"td",6,K),a()),d&2){let t=e.$implicit;m(),W(t)}}var F=class F{constructor(){this.modelChange=new v;this.hovered=null;this.matriz=[[0,1,2],[3,4,5],[6,7,8]]}get seleccion(){return this.model?.zone??null}seleccionar(e){this.model.zone=e,this.modelChange.emit(this.model)}};F.\u0275fac=function(t){return new(t||F)},F.\u0275cmp=y({type:F,selectors:[["app-zone-screen"]],inputs:{model:"model"},outputs:{modelChange:"modelChange"},decls:11,vars:0,consts:[[1,"mb-3"],["for","messagePosition",1,"form-label"],[1,"row","justify-content-center"],[1,"col-12","d-flex","justify-content-center"],[1,"table","text-center","custom-table","w-100"],[1,"form-text","text-muted"],[1,"custom-cell",3,"hovered","selected"],[1,"custom-cell",3,"mouseenter","mouseleave","click"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"label",1),r(2,"Posici\xF3n en la Pantalla"),a(),o(3,"div",2)(4,"div",3)(5,"table",4)(6,"tbody"),L(7,Me,3,0,"tr",null,K),a()()(),o(9,"small",5),r(10,"Establece la zona de la pantalla donde mostraremos el mensaje."),a()()()),t&2&&(m(7),W(n.matriz))},dependencies:[E,S],styles:[".custom-table[_ngcontent-%COMP%]{border:3px solid gray;border-radius:20px;padding:10px;border-collapse:separate;border-spacing:0;background-color:#fff}.custom-cell[_ngcontent-%COMP%]{border:1px solid lightgray;font-size:40px;color:gray;padding:10px 20px;vertical-align:middle;text-align:center;cursor:pointer;transition:background-color .2s,color .2s}.custom-cell.hovered[_ngcontent-%COMP%]{background-color:gray;color:#fff}.custom-cell.selected[_ngcontent-%COMP%]{background-color:#4b4b4b;color:#fff}"]});var H=F;var T=ge(pe());function be(d,e){if(d&1){let t=w();o(0,"app-image-message",8),c("modelChange",function(s){g(t);let i=u();return p(i.onModelChange(s))}),a()}if(d&2){let t=u();_("model",t.message)}}function ye(d,e){if(d&1){let t=w();o(0,"app-text-message",8),c("modelChange",function(s){g(t);let i=u();return p(i.onModelChange(s))}),a()}if(d&2){let t=u();_("model",t.message)}}function ve(d,e){if(d&1){let t=w();o(0,"button",16),c("click",function(){g(t);let s=u();return p(s.delete_message(s.message))}),x(1,"i",12),r(2," Eliminar "),a()}if(d&2){let t=u();_("disabled",t.loading||t.saving)}}var N=class N{constructor(e){this.catalogService=e;this.loading=!1;this.saving=!1;this.messages=[];this.item_id_selected=0;this.message=this.newEmptyMessage();this.trackByItemId=(e,t)=>t.item_id??-1}ngOnInit(){this.getMessages()}newEmptyMessage(){return{item_id:0,description:"",type:"image",content:{image:""},duration:10,link:"https://ec.linkedin.com/company/gurpo-kfc-ecuador",zone:9,width:300}}deepClone(e){return JSON.parse(JSON.stringify(e))}toBackendPayload(e){let t;return e.type==="image"?t={image:e?.content&&typeof e.content=="object"&&"image"in e.content?e.content.image??"":typeof e.content=="string"?e.content:""}:e?.content&&typeof e.content=="object"&&"title"in e.content&&"text"in e.content?t={title:e.content.title??"",text:e.content.text??""}:t={title:"",text:typeof e.content=="string"?e.content:""},b(f({},e.item_id&&e.item_id>0?{item_id:e.item_id}:{}),{description:(e.description??"").trim(),type:e.type,content:t,duration:Number(e.duration)||0,link:(e.link??"").trim(),zone:e.zone,width:e.width})}stripItemId(e){let s=e,{item_id:t}=s;return Q(s,["item_id"])}delete_message(e){return z(this,null,function*(){if(!e?.item_id||e.item_id<=0){yield T.default.fire({icon:"info",title:"Nada que eliminar",text:"El mensaje a\xFAn no tiene un item_id v\xE1lido."});return}if((yield T.default.fire({title:"\xBFEliminar mensaje?",text:"Esta acci\xF3n no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar",cancelButtonText:"No, cancelar"})).isConfirmed&&!this.saving){this.saving=!0;try{yield this.catalogService.delete("messages",e.item_id),this.item_id_selected===e.item_id&&(this.item_id_selected=0,this.message=this.newEmptyMessage()),yield this.getMessages(),yield T.default.fire({icon:"success",title:"Mensaje eliminado",text:"Se elimin\xF3 correctamente."})}catch(n){console.error("Error eliminando Message:",n),yield T.default.fire({icon:"error",title:"Error",text:n?.message??"Ocurri\xF3 un error al eliminar el mensaje."})}finally{this.saving=!1}}})}getMessages(){return z(this,null,function*(){this.loading=!0;try{let{response:e}=yield this.catalogService.list("messages");if(this.messages=e??[],this.item_id_selected>0){let t=this.messages.find(n=>n.item_id===this.item_id_selected);this.message=t?this.deepClone(t):this.newEmptyMessage(),t||(this.item_id_selected=0)}}catch(e){console.error("Error cargando Messages:",e),this.messages=[],this.item_id_selected=0,this.message=this.newEmptyMessage()}finally{this.loading=!1}})}onModelChange(e){this.message=this.deepClone(e)}onTipoCambiado(e){let t=(e??"").toLowerCase();this.message.type=t,t==="text"?(this.message.content=typeof this.message.content=="object"&&this.message.content!==null&&"title"in this.message.content&&"text"in this.message.content?this.message.content:{title:"",text:""},this.message.width=void 0):t==="image"&&(this.message.content=typeof this.message.content=="object"&&this.message.content!==null&&"image"in this.message.content?this.message.content:{image:""})}onCambioItemId(e){if(!e||e===0){this.item_id_selected=0,this.message=this.newEmptyMessage();return}let t=this.messages.find(n=>n.item_id===e);this.item_id_selected=e,this.message=t?this.deepClone(t):this.newEmptyMessage(),t?.item_id&&(this.message.item_id=t.item_id)}cancel(){this.item_id_selected=0,this.message=this.newEmptyMessage()}saveMessage(){return z(this,null,function*(){if(this.saving)return;let e=!!(this.message.item_id&&this.message.item_id>0),t=e?"\xBFEst\xE1 seguro de actualizar los datos?":"\xBFEst\xE1 seguro de guardar los datos?",n=e?"S\xED, actualizar":"S\xED, guardar";if((yield T.default.fire({title:t,icon:"question",showCancelButton:!0,confirmButtonText:n,cancelButtonText:"No, cancelar"})).isConfirmed){this.saving=!0;try{let i=this.toBackendPayload(this.message);if(e)yield this.catalogService.update("messages",i);else{let{response:l}=yield this.catalogService.create("messages",this.stripItemId(i));l?.item_id&&(this.item_id_selected=l.item_id)}if(yield this.getMessages(),this.item_id_selected>0){let l=this.messages.find(J=>J.item_id===this.item_id_selected);this.message=l?this.deepClone(l):this.newEmptyMessage()}else if(e&&this.message.item_id){let l=this.messages.find(J=>J.item_id===this.message.item_id);l?(this.item_id_selected=l.item_id,this.message=this.deepClone(l)):this.message=this.newEmptyMessage()}else this.message=this.newEmptyMessage();yield T.default.fire({icon:"success",title:e?"Mensaje actualizado":"Mensaje guardado",text:"La operaci\xF3n se realiz\xF3 correctamente."})}catch(i){console.error("Error guardando Message:",i),yield T.default.fire({icon:"error",title:"Error",text:i?.message??"Ocurri\xF3 un error al guardar el mensaje."})}finally{this.saving=!1}}})}};N.\u0275fac=function(t){return new(t||N)($(me))},N.\u0275cmp=y({type:N,selectors:[["app-messages"]],decls:23,vars:8,consts:[[1,"container"],[1,"row"],[1,"col-12","mb-1"],[1,"col-12","mb-4"],[1,"row","g-3"],[1,"col-12","col-md-4"],[3,"item_idCambiado","modelChange","tipoCambiado","item_id_selected","model","messages"],[3,"model"],[3,"modelChange","model"],[1,"d-flex","justify-content-center","align-items-center","gap-2","mt-4"],["role","group","aria-label","Toolbar de acciones",1,"btn-group"],["type","button",1,"btn","btn-dark",3,"click","disabled"],[1,"fas","fa-save"],["type","button",1,"btn","btn-outline-danger",3,"click","disabled"],[1,"fas","fa-times"],["type","button",1,"btn","btn-danger",3,"disabled"],["type","button",1,"btn","btn-danger",3,"click","disabled"]],template:function(t,n){if(t&1&&(o(0,"div",0)(1,"div",1)(2,"h1",2),r(3," Administraci\xF3n de Mensajes "),a(),o(4,"small",3),r(5," Permite la administraci\xF3n de los mensajes que se env\xEDan en la plataforma de Comunicaci\xF3n de Grupo KFC "),a()(),o(6,"div",4)(7,"div",5)(8,"app-base-message",6),c("item_idCambiado",function(i){return n.onCambioItemId(i)})("modelChange",function(i){return n.onModelChange(i)})("tipoCambiado",function(i){return n.onTipoCambiado(i)}),a()(),o(9,"div",5),O(10,be,1,1,"app-image-message",7)(11,ye,1,1,"app-text-message",7),a(),o(12,"div",5)(13,"app-zone-screen",8),c("modelChange",function(i){return n.onModelChange(i)}),a()()(),o(14,"div",9)(15,"div",10)(16,"button",11),c("click",function(){return n.saveMessage()}),x(17,"i",12),r(18," Guardar "),a(),o(19,"button",13),c("click",function(){return n.cancel()}),x(20,"i",14),r(21," Cancelar "),a(),O(22,ve,3,1,"button",15),a()()()),t&2){let s;m(8),_("item_id_selected",n.item_id_selected)("model",n.message)("messages",n.messages),m(2),P((s=n.message.type)==="image"?10:s==="text"?11:-1),m(3),_("model",n.message),m(3),_("disabled",n.loading||n.saving),m(3),_("disabled",n.loading||n.saving),m(3),P(n.message.item_id&&n.message.item_id>0?22:-1)}},dependencies:[q,R,G,H],encapsulation:2});var ce=N;export{ce as MessagesComponent};
