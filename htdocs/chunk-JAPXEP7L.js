import{a as U}from"./chunk-WZUGRW7D.js";import{a as K}from"./chunk-LNAHWHDB.js";import"./chunk-R3DSXEXQ.js";import{b as W,c as z,f as A,m as j}from"./chunk-UPQQ6FNK.js";import"./chunk-UH4UVRDG.js";import{$b as L,Eb as x,Fb as I,Ib as T,Jb as P,Kb as C,Lb as n,Mb as o,Nb as M,Rb as O,Zb as d,ab as l,fb as v,lb as m,lc as E,oa as B,oc as s,pa as F,pc as N,sc as b,tb as _,tc as h,uc as y}from"./chunk-WZJH74Y7.js";import{e as R,h as D}from"./chunk-AQY5CCQG.js";var f=R(K());var H=(c,t)=>t.id;function J(c,t){if(c&1){let r=O();n(0,"tr",5)(1,"td",6),d("click",function(){let a=B(r).$implicit,i=L();return F(i.selectUser(a))}),s(2),o()()}if(c&2){let r=t.$implicit;l(2),N(r.username)}}var u=class u{constructor(){this.users=[];this.userSelected=new _}selectUser(t){this.userSelected.emit(t)}};u.\u0275fac=function(r){return new(r||u)},u.\u0275cmp=m({type:u,selectors:[["app-users-list"]],inputs:{users:"users"},outputs:{userSelected:"userSelected"},decls:12,vars:0,consts:[[1,"p-4","border","rounded","shadow-sm","bg-white","panel-usuarios","d-flex","flex-column"],[1,"mb-3"],[1,"table-wrapper","flex-grow-1","overflow-auto"],[1,"table","custom-table","w-100","text-center","m-0"],[1,"custom-header","sticky-header"],[1,"custom-row"],[1,"custom-cell",3,"click"]],template:function(r,e){r&1&&(n(0,"div",0)(1,"h3",1),s(2,"Lista Usuarios"),o(),n(3,"div",2)(4,"table",3)(5,"thead")(6,"tr")(7,"th",4),s(8,"Cuenta de Usuario"),o()()(),n(9,"tbody"),T(10,J,3,1,"tr",5,H),o()()()()),r&2&&(l(10),P(e.users))},styles:[".panel-usuarios[_ngcontent-%COMP%]{height:550px;overflow-y:auto;display:flex;flex-direction:column}.table-wrapper[_ngcontent-%COMP%]{max-height:100%}.custom-table[_ngcontent-%COMP%]{border:3px solid gray;border-radius:5px;border-collapse:separate;border-spacing:0;background-color:#fff}.sticky-header[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#fff;z-index:1}.custom-header[_ngcontent-%COMP%]{color:#fff;font-weight:700;background-color:#4b4b4b;border-bottom:1px solid lightgray;padding:12px;font-size:16px}.custom-cell[_ngcontent-%COMP%]{border-bottom:1px solid lightgray;color:gray;padding:12px;transition:background-color .2s,color .2s}.custom-row[_ngcontent-%COMP%]:hover   .custom-cell[_ngcontent-%COMP%]{background-color:gray;color:#fff}"]});var S=u;function X(c,t){c&1&&(n(0,"small",5),s(1," Aseg\xFArese de que esta contrase\xF1a coincida con la anterior. "),o())}function Y(c,t){c&1&&(n(0,"small",10),s(1," Las contrase\xF1as no coinciden. "),o())}function Z(c,t){c&1&&(n(0,"small",11),s(1," Las contrase\xF1as coinciden. "),o())}var p=class p{constructor(t){this.backoffice=t;this.user={id:0,username:""};this.save=new _;this.cancel=new _;this.password="";this.confirm_password="";this.loading=!1;this.saving=!1}cancelButton(){this.cancel.emit("cancel"),this.password="",this.confirm_password=""}saveButton(){let t={id:0,username:"",password:""};this.password==this.confirm_password&&(t.id=this.user.id??0,t.username=this.user.username,t.password=this.password,this.save.emit(t))}};p.\u0275fac=function(r){return new(r||p)(v(U))},p.\u0275cmp=m({type:p,selectors:[["app-user-dialog"]],inputs:{user:"user"},outputs:{save:"save",cancel:"cancel"},decls:30,vars:13,consts:[[1,"p-4","border","rounded","shadow-sm","bg-white","panel-usuarios"],[1,"mb-4"],[1,"mb-3"],["for","emailInput",1,"form-label"],["type","email","id","emailInput","placeholder","usuario@ejemplo.com","name","username",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-text","text-muted"],["for","passwordInput",1,"form-label"],["type","password","id","passwordInput","placeholder","Ingrese una contrase\xF1a segura","name","password",1,"form-control",3,"ngModelChange","ngModel"],["for","confirmPasswordInput",1,"form-label"],["type","password","id","confirmPasswordInput","placeholder","Repita la contrase\xF1a","name","confirm_password",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-text","text-danger"],[1,"form-text","text-success"],[1,"d-flex","justify-content-center","align-items-center","gap-2","mt-4"],["role","group","aria-label","Toolbar de acciones",1,"btn-group"],["type","button",1,"btn","btn-dark",3,"click","disabled"],[1,"fas","fa-save"],["type","button",1,"btn","btn-outline-danger",3,"click"],[1,"fas","fa-times"]],template:function(r,e){r&1&&(n(0,"div",0)(1,"h3",1),s(2,"Nuevo Usuario"),o(),n(3,"div",2)(4,"label",3),s(5,"Correo Electr\xF3nico"),o(),n(6,"input",4),y("ngModelChange",function(i){return h(e.user.username,i)||(e.user.username=i),i}),o(),n(7,"small",5),s(8," Ingrese la direcci\xF3n de correo electr\xF3nico del usuario. "),o()(),n(9,"div",2)(10,"label",6),s(11,"Contrase\xF1a"),o(),n(12,"input",7),y("ngModelChange",function(i){return h(e.password,i)||(e.password=i),i}),o(),n(13,"small",5),s(14," Contrase\xF1a con la que se inicia sesi\xF3n en la plataforma. "),o()(),n(15,"div",1)(16,"label",8),s(17,"Confirmar Contrase\xF1a"),o(),n(18,"input",9),y("ngModelChange",function(i){return h(e.confirm_password,i)||(e.confirm_password=i),i}),o(),x(19,X,2,0,"small",5)(20,Y,2,0,"small",10)(21,Z,2,0,"small",11),o(),n(22,"div",12)(23,"div",13)(24,"button",14),d("click",function(){return e.saveButton()}),M(25,"i",15),s(26," Guardar "),o(),n(27,"button",16),d("click",function(){return e.cancelButton()}),M(28,"i",17),s(29," Cancelar "),o()()()()),r&2&&(l(6),b("ngModel",e.user.username),l(6),E("is-valid",e.password&&e.confirm_password&&e.password===e.confirm_password)("is-invalid",e.password&&e.confirm_password&&e.password!==e.confirm_password),b("ngModel",e.password),l(6),E("is-valid",e.password&&e.confirm_password&&e.password===e.confirm_password)("is-invalid",e.password&&e.confirm_password&&e.password!==e.confirm_password),b("ngModel",e.confirm_password),l(),I(!e.password||!e.confirm_password?19:e.password!==e.confirm_password?20:21),l(5),C("disabled",!(e.password&&e.confirm_password&&e.password===e.confirm_password)))},dependencies:[j,W,z,A],styles:[".panel-usuarios[_ngcontent-%COMP%]{height:550px;overflow-y:auto;display:flex;flex-direction:column}"]});var k=p;var g=class g{constructor(t){this.backoffice=t;this.users=[];this.loading=!1;this.user_selected={username:""}}ngOnInit(){this.loadUsers()}loadUsers(){this.loading=!0,this.backoffice.getAllUsers$().subscribe({next:t=>{this.users=t.response??[],this.loading=!1},error:t=>{this.loading=!1,console.error("[UsersComponent] getAllUsers error:",t)}})}selectedUser(t){this.user_selected=t}saveButton(t){return D(this,null,function*(){let r=(t?.username??"").trim(),e=(t?.password??"").trim(),a=!!(t?.id&&t.id>0);if(!r||!e){yield f.default.fire({icon:"warning",title:"Datos incompletos",text:"Usuario y contrase\xF1a son obligatorios."});return}if((yield f.default.fire({title:a?"\xBFEst\xE1 seguro de actualizar los datos?":"\xBFEst\xE1 seguro de guardar los datos?",icon:"question",showCancelButton:!0,confirmButtonText:a?"S\xED, actualizar":"S\xED, guardar",cancelButtonText:"No, cancelar"})).isConfirmed)try{if(a)yield this.backoffice.updateUser({id:t.id,username:r,password:e}),this.loadUsers(),yield f.default.fire({icon:"success",title:"Usuario actualizado",text:"La operaci\xF3n se realiz\xF3 correctamente."}).then(()=>window.location.reload());else{let{response:w}=yield this.backoffice.createUser({username:r,password:e});w?.id&&(this.user_selected=w),this.loadUsers(),f.default.fire({icon:"success",title:"Usuario creado",text:"La operaci\xF3n se realiz\xF3 correctamente."}).then(()=>window.location.reload())}}catch(w){console.error("[UsersComponent] saveUser error:",w),yield f.default.fire({icon:"error",title:"Error",text:w?.message??"Ocurri\xF3 un error al guardar el usuario."})}})}cancelButton(t){this.user_selected={username:""}}};g.\u0275fac=function(r){return new(r||g)(v(U))},g.\u0275cmp=m({type:g,selectors:[["app-users"]],decls:11,vars:2,consts:[[1,"container"],[1,"row"],[1,"col-12","mb-4"],[1,"col-12","col-md-6","mb-4","mb-md-0"],[3,"cancel","save","user"],[1,"col-12","col-md-6"],[3,"userSelected","users"]],template:function(r,e){r&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),s(3," Administraci\xF3n de Usuarios "),o(),n(4,"small",2),s(5,"Permite la gesti\xF3n de cuentas de usuarios que administran la plataforma de Comunicaci\xF3n de Grupo KFC"),o()(),n(6,"div",1)(7,"div",3)(8,"app-user-dialog",4),d("cancel",function(i){return e.cancelButton(i)})("save",function(i){return e.saveButton(i)}),o()(),n(9,"div",5)(10,"app-users-list",6),d("userSelected",function(i){return e.selectedUser(i)}),o()()()()),r&2&&(l(8),C("user",e.user_selected),l(2),C("users",e.users))},dependencies:[k,S],encapsulation:2});var V=g;export{V as UsersComponent};
